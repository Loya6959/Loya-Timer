# Loya Timer开发规范【2025-08-10 创建】

此规范旨在规定开发此项目时的个中代码、文件管理、分支管理等开发活动中可能涉及到的行为限制细则，请参与此项目的开发者**严格遵守**本规范，保证开源项目的可读性、可维护性是每一个参与开发的开发者之职责。

本规范中，会严格认定某些专有名词之含义，部分需要特别解释的名词，会在本规范的末尾详细解释。

此外：

+ 不要随意修改本规范，如果遇到可能的错误，请提issue，或者通过电子邮箱联系；
+ 如有规范中未提及的部分，请见上一条的处理方案。

在本规范中：

+ 应当：一般语境下的“必须”
+ 不应：一般语境下的“不能”、“绝不允许”

## 目录和文件

本项目中，Python文件一般是直接放在项目根目录，如果是若干个Python文件组成的包，请在根目录单独创建文件夹存放。

本项目中，`views`文件夹（下述无序列表中所指的根目录）存放着所有前端的源码、资源等文件，其中：

+ **\*.html**：直接存放于根目录，不单独创建文件夹存放
+ **\*.css**：存放于根目录中`css`文件夹下，必须以引用它的html文件的名字为基准，例如`index.css`、`index-light.css`
+ **\*.js**：存放于根目录中`js`文件夹下，必须以引用它的html文件的名字为基准，例如`index.js`、`index-trigger.js`

此外，排除目录中的这些文件/文件夹，*建议*根据以下用途实际使用它们：

+ `env`：Python虚拟环境
+ `run-dev.py`：开发模式主入口脚本
+ `/ts`：存放TypeScript源码的文件夹

项目的`LICENSE`文件夹用于存放使用到的第三方项目所使用的许可证，如果需要添加新的第三方项目（例如使用新的Python包），请在该文件夹新建一个以该项目名称命名的文件夹，并且在其中按照具体开源协议的要求附带需求的文件。

## 基本分工原则

分工协作时，**应当**以这三个基本原则划分分工细则：

1. 前后端分离原则；
2. README、LICENSE、开发规范等文件与实际源码文件的分离原则；
3. 图像资源、Svg与其他文件相独立原则。

合作过程中的分工时，**应当**由主开发者负责协调、规划、敲定最终分工，如果是一个分工产生的新的子分工，则只需要负责该部分的开发者协调规划敲定。

确定好具体分工后，**应当**创建对应的分支进行开发管理，完成开发后，由主开发者进行分支合并操作。请注意，开发本项目时，**不应**直接在主分支进行操作，除非更改只是对README的“增加”。

## 代码规范

在开发过程中，**应当**遵守这些规范：

### Python

开发本项目时，使用CPython3.12版本进行开发、测试、打包等工作，以下的所有规范中提及到的语法，皆以3.12版本的语法为准。

本项目Python的开发规范基于Python pep8规范，在此基础上进行额外要求。

特别说明，本项目的Python代码，同样限制代码行长度不超过79字符。

#### 基本注释和文档字符串

注释的基本原则是：尽可能保持较少的注释。例如下面的代码：

```Python
x: int = 1920 # x坐标
y: int = 1080 # y坐标

print((x, y)) # 打印坐标
```

上面的代码中，三个注释都是无效注释，请不要滥用注释，过多的注释同样会导致源码的可读性降低。注释**应当**用来说明一些无法通过代码直接看出行为的情况，或者在`class`中对每一个属性进行说明，例如：

```Python
class SthriD:
    def __init__(self: Self, start: int, end: int):
        self.start = start # 数据开始标记
        self.end = end # 数据结束标记
```

跨行字符串[^1]**不应**直接作为注释使用，以下用法是**绝不允许**的：

```Python
class WhatFuckClassCode:
    data1 = ""
    """数据1"""
    
    data2 = ""
    """数据2"""
```

或者：

```Python
class WhatFuckClassCode:
    """数据1"""
    data1 = ""
    
    """数据2"""
    data2 = ""
```

以上错误的直接处理方案是改为Python唯一的注释语法，也就是以`#`开头的单行注释，在只是对一行进行说明时，请在该行的后面注释描述。不过，如果添加上注释后代码行字符数超过79，就请将注释的位置放在说明的代码语句紧挨着的上一行（注意，此时注释**应当**单独成行）。

本项目中，“文档字符串”的概念更加严苛，它是指一个位于文件、函数、类第一行开始，直至该字符串结束的跨行字符串：

```Python
"""文档字符串1"""

def this_is_good_function():
    """文档字符串2"""


class ThisIsGoodClass:
    """文档字符串3"""
    def __init__(self): pass
```

脱离这些位置的，即便在其他项目是“文档字符串”，在该项目中也不会如此认可。文档字符串内部的编写规范遵循[Google开源项目风格](https://zh-google-styleguide.readthedocs.io/en/latest/google-python-styleguide/python_style_rules.html#docstring)，这是为了让VSCode等编辑器更好的进行代码提示。

注意，文档字符串中间**不应**有阻断，例如：

```Python
class BadDocumentString1:
    """文档字"""
    """符串"""

class BadDocumentString2:
    """文档字"""

    """符串"""

class BadDocumentString2:
    """文档字"""
    pass
    """符串"""
```

#### 语义化命名和类型标注

Python的变量、函数、类名**应当**遵循如下规则：

+ 变量、函数使用蛇形命名法，常量全部大写，一般变量小写
+ 类使用大驼峰命名法

此外：

+ is开头的函数、方法，必须明确使用下划线`_`分割is和is后的部分，例如`is_enumint`
+ 蛇形命名法中，数字建议不单独分割，例如`test_trigger_1`可以直接改成`test_trigger1`

编写Python代码时，**应当**在可以添加类型标注的任何地方添加对应的类型标注，这包括类中`__init__`方法中的`self`参数，当然：

+ `NoReturn`、`Self`、`Any`必须从`typing`中导入，而不是使用`type`语句自定义

有关`typing`的入门，请看本人的[博客: Python类型标注](https://loya6959.github.io/2024/09/17/Python%E7%B1%BB%E5%9E%8B%E6%A0%87%E6%B3%A8/)，或者查看[Python官方文档](https://docs.python.org/zh-cn/3/library/typing.html)学习。

#### 行长度、缩进和空行

在本项目中，行的最大程度依旧如pep8规范指导的那样，注释、文档字符串最大行长72字符，代码最大行长79字符（建议在VSCode中配置标尺）。如果一行代码语句超过了上述限制，请合理使用各种续行手段，例如括号跨行、临近字符串自动拼接等。

本项目使用四个空格作为基本缩进，任何制表符、`LF`、`CRLF`字符均不允许被使用，同时，由于部分输入法容易将空格输入成全角空格，建议编写代码时格外关注这部分输入法的状态。

在本项目中，空行基本原则同样遵循pep8规范，也就是说：

+ 函数、类定义只见使用两个空行分割
+ 不同的代码部分使用一个空行分割
+ 导入语句与正式的代码片段使用两个空行分割
+ 代码末尾始终保持存在一个空行

此外，**不应**在任何的代码语句末尾添加分号。

#### import

在import模块或包时，**应当**使用相对导入语法，例如`from . import yazi`，如果一个文件位于项目根目录，则可以直接使用绝对导入，例如`from web import cfg`，注意，只有在这个文件位于根目录，需要导入同级或子级目录的模块时，才能使用绝对导入。

在本项目中，**绝对禁止**使用`from pack import *`这种完全解包导入，这样做大概率扰乱现有脚本的环境，还可能导致部分函数达不到预期的效果甚至出现严重的错误。

在使用`from import`语法时，**应当**遵循“使用原则”，也就是说，只能导入**确认使用的函数、内建对象、类、变量**等。一个符合上述原则的导入示例：

```Python
from typing import NoReturn
from math import sin

def this_is_no_return_func() -> NoReturn:
    pass

def my_sin(x:int | float) -> float:
    return sin(x)
```

此外，善用`as`创建别名，使用`as`创建别名时，同样遵循[语义化命名和类型标注](#语义化命名和类型标注)小结规定的细则。

如果一个模块使用到的函数、类等对象累计数量超过10，**应当**改用普通的`import`语法直接导入对应的模块、包本身。

### JSON

这里只是简单提一嘴，在本项目中，被实际使用的JSON文件**不应**使用注释，字段的命名遵循蛇形命名法（全部小写），但其中的下划线`_`应当替换为减号`-`。

### HTML

在本项目中，**应当**使用HTML5规范编写所有的HTML文档，其中需要嵌入`bottle`模板或`Jinja2`模板的部分，遵循相应的语法即可，请注意，使用`bottle`时，不要使用格式化文档，这会造成严重的错误，进而导致页面渲染整体出现问题。

#### 语义化元素[^2]

在创建这些内容时，应当使用给出的这些元素进行创建：

+ 斜体：`<i>`
+ 强调文本：`<strong>`
+ 导航链接块：`<nav>`
+ 页脚：`<footer>`
+ 对话框：`<dialog>`
+ 主体->头部：`<header>`

此外，这些元素不应该被使用：

+ 删除线：`<s>`
+ 删除线：`<strike>`
+ 下划线：`<u>`
+ 基本字体：`<basefont>`
+ 居中文本：`<center>`
+ 目录列表：`<dir>`
+ 强调文本：`<em>`
+ 字体：`<font>`
+ 菜单列表：`<menu>`

以及其他不推荐使用的元素。

HTML元素对大小写不敏感，因此使用任何HTML元素时，**应当**全部使用小写。

本项目使用HTMLX语法编写整个HTML源码，也就是说：

+ 元素必须正确嵌套
+ 元素必须得到封闭
+ 除非有实际的JavaScript定义，否则不能使用不存在，和不推荐使用的元素

示例：

```HTML
<div>
    <p>这是一段符合HTMLX语法的HTML代码</p>
    <hr /> <!-- 非成对元素，在其`>`字符前紧挨着加上斜线`/` -->
</div>
```

#### 行和缩进

本项目中，HTML**不限制**行长度，但推荐将行长度限制在尽可能短的范围，方便查看。

本项目中，使用四个空格作为基本缩进，不允许使用制表符等其他空白符作为缩进。这个限制只针对HTML文档代码本身，如果是实际内容中，不限制缩进（但也尽可能使用普通的空格）。

本项目中，可以使用空行分割HTML中不同的部分，但分割空行不能超过两行，此外，HTML文档的末尾不加额外空行。

### CSS

本项目的CSS不做过多限制（本来可读性就差，吐槽），但：

+ 尽可能使用新规范的语法（当然，兼容性必须首要考虑）
+ 合理使用嵌套语法
+ 不要使用已经废弃的CSS属性
+ 合理使用注释

### JavaScript

JavaScript代码**应当**由TypeScript生成（注意，一定要使用`es2024`规范）。其余部分不过多阐述，遵循流行的规范即可。

## 分支管理

本项目中，主分支的`merge`、修改权限完全交由主开发者，任何人不得越权。

创建分支时，**应当**：

+ 主要分工从主分支创建子分支
+ 细分任务从上一条创建的分支创建子分支
+ 非主分支的`merge`和其他权限，由分支的主要开发者负责
+ `merge`分支时，**应当**使用`--no-ff`选项
+ 移除文件，**应当**使用`git rm`命令，而不是实际删除文件后使用`git add .`
+ 提交信息不能留空，至少需要一条简短的有效信息
+ 不要越权编辑非自己创建的分支，即便是主要开发者也是如此

## 其他

这里直接罗列了：

1. 主开发者不是皇帝，建议只是建议；
2. 任何节点开发者都必须严格审查代码（例如分支的管理者）；
3. 严格遵守“三个不信任”原则：
    + 用户不信任：用户的操作默认无法预测，额外检查
    + 前端不信任：前端返回需要额外检查
    + 自我不信任：不要过于自信，即便是自己的代码也需要严格审查
4. 新加入成员必须仔细审核，尤其需要检查成员有无难以容忍的黑历史（例如向其他项目嵌入过恶意代码、进行过网暴行为、进行过开盒行为或者其他严重违规违法行为等）；
5. 合作开发者，应当在主分支的`author.txt`文件加上自己的名字（常用名即可，建议不要使用现实名字），格式如下（该文件中同样有注释说明格式）：

    > \# <昵称> <电子邮箱> [备注]
    >
    > 络亚Loya [Loya6959@outlook.com](#词注) 主开发者

    注意，这里为了规避MarkDown插件的警告，将电子邮箱写成了md链接的写法，实际编写时请直接写下电子邮箱地址即可。此外，**向此文件进行内容添加的权限，主开发者默认允许**；

6. 合作者辱骂其他合作者，拒不悔改的（实行三次警告原则），永久禁止其继续参与开发，并且将其除名；
7. 合作者在合作期间，进行严重违规违法行为，或者参与网暴、开盒、不正当黑客行为、利用本项目进行著作权侵权等行为的，实行一次警告原则，拒不悔改的，永久禁止其继续参与开发，并将其永久除名；
8. 针对5、6，警告不予以公示，但除名**应当**予以公示；
9. 因为各种原因淡出或退出合作开发的，**应当**保留其名字，但需要在其名字后面添加一个时间，说明其退出的时间（淡出开发的不用标记时间）；

## 词注

[^1]: 在Python中，使用三个一组成对的`"`或`'`创建跨行字符串，跨行字符串**不是Python的多行注释**。

[^2]: HTML中的俗称“标签”的东西，正确的叫法是元素。
